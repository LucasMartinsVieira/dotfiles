#!/usr/bin/env bash

BLUETOOTH_STATE=$(bluetoothctl show | grep Powered: | awk '{print $2}')
WIFI_STATE=$(nmcli radio wifi)
TRAYER_IS_OPEN=$(pgrep trayer)
SWAY_IDLE_IS_OPEN=$(pgrep swayidle)
WAYBAR_IS_OPEN=$(pgrep waybar)

# INFO: First argument is an Image, second is the service and the third is the state
notify_user() {
  notify-send -t 1800 -u normal "$1: $2"
}

bluetooth() {
  if [[ "$BLUETOOTH_STATE" == "yes" ]]; then
    bluetoothctl power off
    notify_user "Bluetooth" "OFF"
  else
    bluetoothctl power on
    notify_user "Bluetooth" "ON"
  fi
}

wifi() {
  if [[ "$WIFI_STATE" == "enabled" ]]; then
    nmcli radio wifi off
    notify_user "Wifi" "OFF"
  elif [[ "$WIFI_STATE" == "disabled" ]]; then
    nmcli radio wifi on
    notify_user "Wifi" "ON"
  fi
}

tray() {
  if [[ "$TRAYER_IS_OPEN" ]]; then
    killall trayer
  else
    killall trayer
    trayer --width 10 --height 25 --iconspacing 2
  fi
}

idle() {
  if [[ "$SWAY_IDLE_IS_OPEN" ]]; then
    killall swayidle
    notify_user "" "Sway IDLE" "OFF"
  else
    swayidle -w \
      timeout 300 "swaylock -f" \
      timeout 301 'wlopm --off "*" ' \
      resume 'wlopm --on "*" ' &
    notify_user "" "Sway IDLE" "ON"
  fi
}

bar() {
  if [[ "$WAYBAR_IS_OPEN" ]]; then
    killall waybar
  else
    waybar -c ~/.config/niri/waybar/config.jsonc -s ~/.config/niri/waybar/style.css
  fi

}

if [[ "$1" == "-b" ]]; then
  bluetooth
elif [[ "$1" == "-w" ]]; then
  wifi
elif [[ "$1" == "-t" ]]; then
  tray
elif [[ "$1" == "-i" ]]; then
  idle
elif [[ "$1" == "-y" ]]; then
  bar
else
  exit 1
fi
