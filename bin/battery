#!/usr/bin/env bash

BAT_ICON=$HOME/.config/river/assets/battery_low.png
BAT_LEVEL=$(cat /sys/class/power_supply/BAT?/capacity 2>/dev/null | head -1)
BAT_STATE=$(cat /sys/class/power_supply/BAT?/status 2>/dev/null | head -1)
INTERVAL="480"

main() {
  DUNST_PAUSED=$(dunstctl is-paused)

  if [[ $DUNST_PAUSED == "true" ]]; then
    dunstctl set-paused false
  fi

  if [[ $BAT_LEVEL -le 25 && $BAT_STATE != "Charging" ]]; then
    notify-send "Low Battery" "$BAT_LEVEL% of battery remaining" -i "$BAT_ICON" -t 30000 -r 9991 -u critical -h int:value:$(($BAT_LEVEL))
  fi
}

while true; do
  main
  sleep $INTERVAL
done
